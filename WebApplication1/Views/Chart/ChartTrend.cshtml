@model WebApplication1.Models.HistoryModel
@{
    ViewBag.Title = "Chart Trend";
}
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<script>
    var chartData; // globar variable for hold chart data
    google.charts.load('current', { 'packages': ['corechart'] });
    var intervalTime = 90000;

    function FirstMetToGetData(chartTypeTrend) {
        $.ajax({
            url: '/Chart/GetChartDataTrend',
            data: "",
            dataType: "json",
            type: "GET",
            contentType: "application/json; chartset=utf-8",
            success: function (data) {
                chartData = data;//.JSONList;
            },
            error: function () {
                alert("Error loading data! Please try again.");
            }
        }).done(function () {
            // after complete loading data
            google.setOnLoadCallback(function () { drawChart(chartTypeTrend); });
            drawChart(chartTypeTrend);
        });
    }

    $(document).ready(FirstMetToGetData('ColumnChart'));

    function drawChart(chartTypeTrend) {
        var data = new google.visualization.DataTable();
        console.log('Si Sinior');
        data.addColumn('string', 'Date');
        data.addColumn('number', 'SBRK');
        data.addColumn('number', 'SLHIPA');
        data.addColumn('number', 'SLDHPA');
        data.addColumn('number', 'SOT');
        data.addColumn('number', 'SLT');

        // sample data: var data = [{ Date: "20140124", Visitors: "873" }, { Date: "20140125", Visitors: "875" }];
        for (var i = 0; i < chartData.length; i++) {
            data.addRow(chartData[i]);
        }
        //var data = google.visualization.arrayToDataTable(chartData);

        var options = {
            title: "Trend Chart- SBRK, SLHiPA, SLDHPA, SOT and SLT",
            //pointSize: 5,
            hAxis: { title: 'Date Time', titleTextStyle: { color: 'red' } },
            bar: { groupWidth: '50%' },
            isStacked: true,
        };

        //ColumnChart
        if (chartTypeTrend == 'LineChart') {
            var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
        }
        if (chartTypeTrend == 'ColumnChart') {
            var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
        }


        // Wait for the chart to finish drawing before calling the getImageURI() method.
        google.visualization.events.addListener(chart, 'ready', function () {
            document.getElementById('png').outerHTML = '<a href="' + chart.getImageURI() + '" download="trend' + Date.now() + '"><img border="0" src="/Imges/Wykres.png" alt="Download" width="71" height="51">Printable version</a>';
        });
        chart.draw(data, options);
    }


    setInterval(function () {
        FirstMetToGetData($("#myselect").val());
    }, intervalTime);

    function startTimer(duration, display) {
        var timer = duration, minutes, seconds;
        setInterval(function () {
            minutes = parseInt(timer / 60, 10)
            seconds = parseInt(timer % 60, 10);

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            display.textContent = minutes + ":" + seconds;

            if (--timer < 0) {
                timer = duration;
            }
        }, 1000);
    }

    window.onload = function () {
        var timeInMinutes = intervalTime / 1000, // 60* 5
            display = document.querySelector('#timer');
        startTimer(timeInMinutes, display);
    }

    $(document).ready(function () {
        $('#myselect').change(function () {
            //alert($(this).val());
            console.log($("#myselect").val());
            FirstMetToGetData($("#myselect").val());
        });
    });
</script>
<div align="right">
    Next refresh<div id="timer">mm:ss:ms</div>
</div>
<div style="grid-template-columns: 30% 40%;">
    <div id='png'></div>
    <div>
        <select id="myselect">
            <option value="ColumnChart" selected="selected">Column</option>
            <option value="LineChart">Line</option>
        </select>
    </div>
</div>
<div id="chart_div" style="width: 1900px; height: 900px;">
</div>